"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Rss = (function () {
    function Rss(data, rssType, lan) {
        if (data === void 0) { data = null; }
        if (rssType === void 0) { rssType = ""; }
        if (lan === void 0) { lan = ""; }
        var _this = this;
        this.channel = [];
        if (data) {
            data.rss.channel.forEach(function (channelData) {
                _this.channel.push(new Channel(channelData, rssType, lan));
            });
        }
    }
    return Rss;
}());
exports.Rss = Rss;
var Channel = (function () {
    function Channel(channelData, rssType, lan) {
        if (channelData === void 0) { channelData = null; }
        if (rssType === void 0) { rssType = ""; }
        if (lan === void 0) { lan = ""; }
        var _this = this;
        if (channelData) {
            this.title = this._processTitle(channelData['title'][0], rssType, lan);
            this.description = this._processDescription(channelData['description'][0], rssType, lan);
            this.link = channelData['link'][0];
            this.image = new ChannelImage(channelData['image'][0]);
            this.summary = channelData['itunes:summary'][0];
            this.item = [];
            var index_1 = 0;
            channelData.item.forEach(function (itemData) {
                _this.item.push(new Item(itemData, index_1));
                index_1++;
            });
        }
        else {
            this.title = "";
            this.description = "";
            this.link = "";
            this.image = new ChannelImage(null);
            this.summary = "";
            this.item = [];
        }
    }
    Channel.prototype._processTitle = function (title, rssType, lan) {
        if (rssType == 'qt') {
            if (lan == 'en') {
                return 'Quiet Time';
            }
            else {
                return '每日灵修';
            }
        }
        if (rssType == "weekly_zh") {
            if (lan == 'en') {
                return 'HOC5 Chinese Sermons';
            }
            else {
                return '基督之家第五家中文讲道';
            }
        }
        if (rssType == "weekly_en") {
            if (lan == 'en') {
                return 'HOC5 English Sermons';
            }
            else {
                return '基督之家第五家英文讲道';
            }
        }
        return title;
    };
    Channel.prototype._processDescription = function (description, rssType, lan) {
        if (rssType == "weekly_zh" || rssType == "weekly_en") {
            console.log('pased lan is ', lan);
            if (lan != 'zh') {
                return 'We are called to magnify God and glorify Him, to lead people to Jesus and membership in his family, to play a role in nurturing them to Christ like maturity, and equip them for their ministry in the church and mission in the world.';
            }
            else {
                return '北加州基督之家是由台北基督之家創辦人寇世遠監督所創立，目前基督之家在灣區已經有七家教會。第五家位於矽谷Cupertino市。有關基督之家其他各家的詳細介紹，請到 www.hoc.org';
            }
        }
        else if (rssType = 'qt') {
            return lan == 'en' ? 'For every reborn Christian, there should be one new thing added to his life, Quiet Time with God. This is not only a pure quiet time, but also a holy period with God. ' : '每一個重生得救的基督徒，在他每天的生活裏就多了一樣新事，就是「靈修生活」，它不只是個安靜的時刻 (Quiet time)，也是個敬虔的時間，更是個與神獨處的時光。';
        }
        return description;
    };
    return Channel;
}());
exports.Channel = Channel;
var ChannelImage = (function () {
    function ChannelImage(channelImageData) {
        if (channelImageData === void 0) { channelImageData = null; }
        if (channelImageData) {
            this.url = channelImageData['url'][0];
            this.title = channelImageData['title'][0];
            this.link = channelImageData['link'][0];
        }
        else {
            this.url = "";
            this.title = "";
            this.link = "";
        }
    }
    return ChannelImage;
}());
exports.ChannelImage = ChannelImage;
var CustomItem = (function () {
    function CustomItem() {
    }
    return CustomItem;
}());
exports.CustomItem = CustomItem;
var Item = (function () {
    function Item(itemData, id) {
        if (itemData === void 0) { itemData = null; }
        if (id === void 0) { id = 0; }
        this.id = id;
        if (itemData) {
            this.title = (itemData['title'] && itemData['title'][0]) ? itemData['title'][0] : "";
            this.subTitle = (itemData['itunes:subtitle'] && itemData['itunes:subtitle'][0]) ? itemData['itunes:subtitle'][0].replace('【詳見全文】', '') : "";
            this.summary = (itemData['itunes:summary'] && itemData['itunes:summary'][0]) ? itemData['itunes:summary'][0] : "";
            this.scriptUrl = this._extractScriptUrl(this.summary);
            this.description = (itemData['description'] && itemData['description'][0]) ? itemData['description'][0] : "";
            this.link = (itemData['link'] && itemData['link'][0]) ? itemData['link'][0] : "";
            this.pubDate = itemData['pubDate'] ? this._convertDate(itemData['pubDate'][0]) : "";
            //we first check title, if title contains digits for first 8 characters, we use that as UUID
            if (/\d+/.test(this.title.substr(0, 8))) {
                this.uuid = parseInt(this.title.substr(0, 8));
            }
            else {
                this.uuid = itemData['pubDate'] ? this._generateUUID(itemData['pubDate'][0]) : 0;
            }
            this.duration = (itemData['itunes:duration'] && itemData['itunes:duration'][0]) ? itemData['itunes:duration'][0] : "";
            this.enclosure_link = (itemData['enclosure'] && itemData['enclosure'][0] && itemData['enclosure'][0]['$'] && itemData['enclosure'][0]['$']['url']) ? itemData['enclosure'][0]['$']['url'] : "";
            this.enclosure_length = (itemData['enclosure'] && itemData['enclosure'][0] && itemData['enclosure'][0]['$'] && itemData['enclosure'][0]['$']['length']) ? itemData['enclosure'][0]['$']['length'] : "";
            this.enclosure_type = (itemData['enclosure'] && itemData['enclosure'][0] && itemData['enclosure'][0]['$'] && itemData['enclosure'][0]['$']['type']) ? itemData['enclosure'][0]['$']['type'] : "";
        }
        else {
            this.title = "";
            this.subTitle = "";
            this.summary = "";
            this.description = "";
            this.link = "";
            this.pubDate = "";
            this.duration = "";
            this.enclosure_link = "";
            this.enclosure_length = "";
            this.enclosure_type = "";
        }
    }
    Item.prototype.isTodayPublished = function () {
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!
        var dds = '';
        var mms = '';
        var yyyy = today.getFullYear();
        if (dd < 10) {
            dds = '0' + dd;
        }
        else {
            dds = '' + dd;
        }
        if (mm < 10) {
            mms = '0' + mm;
        }
        else {
            mms = '' + mm;
        }
        var todayStr = yyyy + "-" + mms + "-" + dds;
        var dateToCompare = this.pubDate;
        if (/\d+/.test(this.title.substr(0, 8))) {
            var tmp = this.title.substr(0, 8);
            dateToCompare = tmp.substr(0, 4) + '-' + tmp.substr(4, 2) + '-' + tmp.substr(6, 2);
        }
        return dateToCompare === todayStr;
    };
    Item.prototype._extractScriptUrl = function (content) {
        var startingPos = content.indexOf('<a href=');
        if (startingPos > 0) {
            var endingPos = content.indexOf('"', startingPos + 20);
            if (endingPos > startingPos + 9)
                return content.substring(startingPos + 9, endingPos).replace('amp;', '');
            else
                return '';
        }
        else {
            return '';
        }
    };
    Item.prototype._convertDate = function (dt) {
        //Sat, 26 Aug 2017 00:00:00 -0700
        var parts = dt.split(' ');
        var year = parts[3];
        var day = parts[1];
        var month = '01';
        switch (parts[2].toLowerCase()) {
            case "jan":
                month = '01';
                break;
            case "feb":
                month = '02';
                break;
            case "mar":
                month = '03';
                break;
            case "apr":
                month = '04';
                break;
            case "may":
                month = '05';
                break;
            case "jun":
                month = '06';
                break;
            case "jul":
                month = '07';
                break;
            case "aug":
                month = '08';
                break;
            case "sep":
                month = '09';
                break;
            case "oct":
                month = '10';
                break;
            case "nov":
                month = '11';
                break;
            case "dec":
                month = '12';
                break;
        }
        return year + '-' + month + '-' + day;
    };
    Item.prototype._generateUUID = function (dt) {
        //Sat, 26 Aug 2017 00:00:00 -0700
        var parts = dt.split(' ');
        var year = parts[3];
        var day = parts[1];
        var month = '01';
        switch (parts[2].toLowerCase()) {
            case "jan":
                month = '01';
                break;
            case "feb":
                month = '02';
                break;
            case "mar":
                month = '03';
                break;
            case "apr":
                month = '04';
                break;
            case "may":
                month = '05';
                break;
            case "jun":
                month = '06';
                break;
            case "jul":
                month = '07';
                break;
            case "aug":
                month = '08';
                break;
            case "sep":
                month = '09';
                break;
            case "oct":
                month = '10';
                break;
            case "nov":
                month = '11';
                break;
            case "dec":
                month = '12';
                break;
        }
        var str = year + month + day;
        return parseInt(str);
    };
    return Item;
}());
exports.Item = Item;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXRpZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJlbnRpdGllcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBO0lBRUksYUFBWSxJQUFXLEVBQUUsT0FBb0IsRUFBRSxHQUFhO1FBQWhELHFCQUFBLEVBQUEsV0FBVztRQUFFLHdCQUFBLEVBQUEsWUFBb0I7UUFBRSxvQkFBQSxFQUFBLFFBQWE7UUFBNUQsaUJBT0M7UUFORyxJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNsQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ1AsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUEsV0FBVztnQkFDaEMsS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxPQUFPLENBQUMsV0FBVyxFQUFFLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzlELENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQztJQUNMLENBQUM7SUFDTCxVQUFDO0FBQUQsQ0FBQyxBQVZELElBVUM7QUFWWSxrQkFBRztBQVloQjtJQVFJLGlCQUFZLFdBQWtCLEVBQUUsT0FBb0IsRUFBRSxHQUFhO1FBQXZELDRCQUFBLEVBQUEsa0JBQWtCO1FBQUUsd0JBQUEsRUFBQSxZQUFvQjtRQUFFLG9CQUFBLEVBQUEsUUFBYTtRQUFuRSxpQkEwQkM7UUF4QkcsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNkLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZFLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsR0FB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QUFDO2dCQUFDLEtBQUssQ0FBQztZQUNoQyxLQUFLLEtBQUs7Z0JBQUUsS0FBSyxHQUFHLElBQUksQ0FBQztnQkFBQyxLQUFLLENBQUM7WUFDaEMsS0FBSyxLQUFLO2dCQUFFLEtBQUssR0FBRyxJQUFJLENBQUM7Z0JBQUMsS0FBSyxDQUFDO1lBQ2hDLEtBQUssS0FBSztnQkFBRSxLQUFLLEdBQUcsSUFBSSxDQUFDO2dCQUFDLEtBQUssQ0FBQztZQUNoQyxLQUFLLEtBQUs7Z0JBQUUsS0FBSyxHQUFHLElBQUksQ0FBQztnQkFBQyxLQUFLLENBQUM7UUFDcEMsQ0FBQztRQUNELElBQUksR0FBRyxHQUFHLElBQUksR0FBRyxLQUFLLEdBQUcsR0FBRyxDQUFDO1FBQzdCLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUNMLFdBQUM7QUFBRCxDQUFDLEFBcEpELElBb0pDO0FBcEpZLG9CQUFJIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIFJzcyB7XG4gICAgcHVibGljIGNoYW5uZWw6IENoYW5uZWxbXTtcbiAgICBjb25zdHJ1Y3RvcihkYXRhID0gbnVsbCwgcnNzVHlwZTogc3RyaW5nID0gXCJcIiwgbGFuOnN0cmluZz1cIlwiKSB7XG4gICAgICAgIHRoaXMuY2hhbm5lbCA9IFtdO1xuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgZGF0YS5yc3MuY2hhbm5lbC5mb3JFYWNoKGNoYW5uZWxEYXRhID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5uZWwucHVzaChuZXcgQ2hhbm5lbChjaGFubmVsRGF0YSwgcnNzVHlwZSwgbGFuKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIENoYW5uZWwge1xuICAgIHB1YmxpYyB0aXRsZTogc3RyaW5nO1xuICAgIHB1YmxpYyBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICAgIHB1YmxpYyBpbWFnZTogQ2hhbm5lbEltYWdlO1xuICAgIHB1YmxpYyBzdW1tYXJ5OiBzdHJpbmc7XG4gICAgcHVibGljIGl0ZW06IEl0ZW1bXTtcbiAgICBwdWJsaWMgbGluazogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IoY2hhbm5lbERhdGEgPSBudWxsLCByc3NUeXBlOiBzdHJpbmcgPSBcIlwiLCBsYW46c3RyaW5nPVwiXCIpIHtcblxuICAgICAgICBpZiAoY2hhbm5lbERhdGEpIHtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aGlzLl9wcm9jZXNzVGl0bGUoY2hhbm5lbERhdGFbJ3RpdGxlJ11bMF0sIHJzc1R5cGUsIGxhbik7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gdGhpcy5fcHJvY2Vzc0Rlc2NyaXB0aW9uKGNoYW5uZWxEYXRhWydkZXNjcmlwdGlvbiddWzBdLCByc3NUeXBlLCBsYW4pO1xuICAgICAgICAgICAgdGhpcy5saW5rID0gY2hhbm5lbERhdGFbJ2xpbmsnXVswXTtcbiAgICAgICAgICAgIHRoaXMuaW1hZ2UgPSBuZXcgQ2hhbm5lbEltYWdlKGNoYW5uZWxEYXRhWydpbWFnZSddWzBdKTtcbiAgICAgICAgICAgIHRoaXMuc3VtbWFyeSA9IGNoYW5uZWxEYXRhWydpdHVuZXM6c3VtbWFyeSddWzBdO1xuXG4gICAgICAgICAgICB0aGlzLml0ZW0gPSBbXTtcblxuICAgICAgICAgICAgbGV0IGluZGV4ID0gMDtcblxuICAgICAgICAgICAgY2hhbm5lbERhdGEuaXRlbS5mb3JFYWNoKGl0ZW1EYXRhID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW0ucHVzaChuZXcgSXRlbShpdGVtRGF0YSwgaW5kZXgpKTtcbiAgICAgICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gXCJcIjtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5saW5rID0gXCJcIjtcbiAgICAgICAgICAgIHRoaXMuaW1hZ2UgPSBuZXcgQ2hhbm5lbEltYWdlKG51bGwpO1xuICAgICAgICAgICAgdGhpcy5zdW1tYXJ5ID0gXCJcIjtcblxuICAgICAgICAgICAgdGhpcy5pdGVtID0gW107XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfcHJvY2Vzc1RpdGxlKHRpdGxlLCByc3NUeXBlLCBsYW4pe1xuXG4gICAgICAgIGlmKHJzc1R5cGU9PSdxdCcpe1xuICAgICAgICAgICAgaWYobGFuPT0nZW4nKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ1F1aWV0IFRpbWUnO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgcmV0dXJuICfmr4/ml6XngbXkv64nO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKHJzc1R5cGUgPT0gXCJ3ZWVrbHlfemhcIil7XG4gICAgICAgICAgICBpZihsYW49PSdlbicpe1xuICAgICAgICAgICAgICAgIHJldHVybiAnSE9DNSBDaGluZXNlIFNlcm1vbnMnO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgcmV0dXJuICfln7rnnaPkuYvlrrbnrKzkupTlrrbkuK3mloforrLpgZMnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYocnNzVHlwZSA9PSBcIndlZWtseV9lblwiKXtcbiAgICAgICAgICAgIGlmKGxhbj09J2VuJyl7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdIT0M1IEVuZ2xpc2ggU2VybW9ucyc7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ+Wfuuedo+S5i+WutuesrOS6lOWutuiLseaWh+iusumBkyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGl0bGU7XG5cbiAgICB9XG5cbiAgICBfcHJvY2Vzc0Rlc2NyaXB0aW9uKGRlc2NyaXB0aW9uLCByc3NUeXBlLCBsYW4pIHtcbiAgICAgICAgaWYgKHJzc1R5cGUgPT0gXCJ3ZWVrbHlfemhcIiB8fCByc3NUeXBlID09IFwid2Vla2x5X2VuXCIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwYXNlZCBsYW4gaXMgJywgbGFuKTtcbiAgICAgICAgICAgIGlmKGxhbiE9J3poJyl7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdXZSBhcmUgY2FsbGVkIHRvIG1hZ25pZnkgR29kIGFuZCBnbG9yaWZ5IEhpbSwgdG8gbGVhZCBwZW9wbGUgdG8gSmVzdXMgYW5kIG1lbWJlcnNoaXAgaW4gaGlzIGZhbWlseSwgdG8gcGxheSBhIHJvbGUgaW4gbnVydHVyaW5nIHRoZW0gdG8gQ2hyaXN0IGxpa2UgbWF0dXJpdHksIGFuZCBlcXVpcCB0aGVtIGZvciB0aGVpciBtaW5pc3RyeSBpbiB0aGUgY2h1cmNoIGFuZCBtaXNzaW9uIGluIHRoZSB3b3JsZC4nO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgcmV0dXJuICfljJfliqDlt57ln7rnnaPkuYvlrrbmmK/nlLHlj7DljJfln7rnnaPkuYvlrrblibXovqbkurrlr4fkuJbpgaDnm6PnnaPmiYDlibXnq4vvvIznm67liY3ln7rnnaPkuYvlrrblnKjngaPljYDlt7LntpPmnInkuIPlrrbmlZnmnIPjgILnrKzkupTlrrbkvY3mlrznn73osLdDdXBlcnRpbm/luILjgILmnInpl5zln7rnnaPkuYvlrrblhbbku5blkITlrrbnmoToqbPntLDku4vntLnvvIzoq4vliLAgd3d3LmhvYy5vcmcnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYocnNzVHlwZT0ncXQnKXtcbiAgICAgICAgICAgIHJldHVybiBsYW49PSdlbic/J0ZvciBldmVyeSByZWJvcm4gQ2hyaXN0aWFuLCB0aGVyZSBzaG91bGQgYmUgb25lIG5ldyB0aGluZyBhZGRlZCB0byBoaXMgbGlmZSwgUXVpZXQgVGltZSB3aXRoIEdvZC4gVGhpcyBpcyBub3Qgb25seSBhIHB1cmUgcXVpZXQgdGltZSwgYnV0IGFsc28gYSBob2x5IHBlcmlvZCB3aXRoIEdvZC4gJzogJ+avj+S4gOWAi+mHjeeUn+W+l+aVkeeahOWfuuedo+W+ku+8jOWcqOS7luavj+WkqeeahOeUn+a0u+ijj+WwseWkmuS6huS4gOaoo+aWsOS6i++8jOWwseaYr+OAjOmdiOS/rueUn+a0u+OAje+8jOWug+S4jeWPquaYr+WAi+WuiemdnOeahOaZguWIuyAoUXVpZXQgdGltZSnvvIzkuZ/mmK/lgIvmlazomZTnmoTmmYLplpPvvIzmm7TmmK/lgIvoiIfnpZ7njajomZXnmoTmmYLlhYnjgIInO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkZXNjcmlwdGlvbjtcbiAgICB9XG5cbn1cblxuXG5cbmV4cG9ydCBjbGFzcyBDaGFubmVsSW1hZ2Uge1xuICAgIHB1YmxpYyB1cmw6IHN0cmluZztcbiAgICBwdWJsaWMgdGl0bGU6IHN0cmluZztcbiAgICBwdWJsaWMgbGluazogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IoY2hhbm5lbEltYWdlRGF0YSA9IG51bGwpIHtcblxuICAgICAgICBpZiAoY2hhbm5lbEltYWdlRGF0YSkge1xuICAgICAgICAgICAgdGhpcy51cmwgPSBjaGFubmVsSW1hZ2VEYXRhWyd1cmwnXVswXTtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSBjaGFubmVsSW1hZ2VEYXRhWyd0aXRsZSddWzBdO1xuICAgICAgICAgICAgdGhpcy5saW5rID0gY2hhbm5lbEltYWdlRGF0YVsnbGluayddWzBdO1xuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICB0aGlzLnVybCA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gXCJcIjtcbiAgICAgICAgICAgIHRoaXMubGluayA9IFwiXCI7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDdXN0b21JdGVte1xuICAgIHB1YmxpYyBpZDpudW1iZXI7XG4gICAgcHVibGljIHRpdGxlOnN0cmluZztcbiAgICBwdWJsaWMgbm90ZTpzdHJpbmc7XG4gICAgcHVibGljIGZhdm9yaXRlOmJvb2xlYW47XG4gICAgcHVibGljIHV1aWQ6bnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgSXRlbSB7XG5cbiAgICBwdWJsaWMgaWQ6bnVtYmVyO1xuICAgIHB1YmxpYyB0aXRsZTogc3RyaW5nO1xuICAgIHB1YmxpYyBzdWJUaXRsZTogc3RyaW5nO1xuICAgIHB1YmxpYyBzdW1tYXJ5OiBzdHJpbmc7XG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgcHVibGljIGxpbms6IHN0cmluZztcbiAgICBwdWJsaWMgZW5jbG9zdXJlX2xpbms6IHN0cmluZztcbiAgICBwdWJsaWMgZW5jbG9zdXJlX2xlbmd0aDogc3RyaW5nO1xuICAgIHB1YmxpYyBlbmNsb3N1cmVfdHlwZTogc3RyaW5nO1xuXG4gICAgcHVibGljIGR1cmF0aW9uOiBzdHJpbmc7XG4gICAgcHVibGljIHB1YkRhdGU6IHN0cmluZztcblxuICAgIHB1YmxpYyBzY3JpcHRVcmw6IHN0cmluZztcbiAgICBwdWJsaWMgc2NyaXB0dXJlOiBzdHJpbmc7XG5cbiAgICBwdWJsaWMgdXVpZDpudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3RvcihpdGVtRGF0YSA9IG51bGwsIGlkID0gMCkge1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIGlmIChpdGVtRGF0YSkge1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IChpdGVtRGF0YVsndGl0bGUnXSAmJiBpdGVtRGF0YVsndGl0bGUnXVswXSkgPyBpdGVtRGF0YVsndGl0bGUnXVswXSA6IFwiXCI7XG4gICAgICAgICAgICB0aGlzLnN1YlRpdGxlID0gKGl0ZW1EYXRhWydpdHVuZXM6c3VidGl0bGUnXSAmJiBpdGVtRGF0YVsnaXR1bmVzOnN1YnRpdGxlJ11bMF0pID8gaXRlbURhdGFbJ2l0dW5lczpzdWJ0aXRsZSddWzBdLnJlcGxhY2UoJ+OAkOips+imi+WFqOaWh+OAkScsICcnKSA6IFwiXCI7XG5cbiAgICAgICAgICAgIHRoaXMuc3VtbWFyeSA9IChpdGVtRGF0YVsnaXR1bmVzOnN1bW1hcnknXSAmJiBpdGVtRGF0YVsnaXR1bmVzOnN1bW1hcnknXVswXSkgPyBpdGVtRGF0YVsnaXR1bmVzOnN1bW1hcnknXVswXSA6IFwiXCI7XG4gICAgICAgICAgICB0aGlzLnNjcmlwdFVybCA9IHRoaXMuX2V4dHJhY3RTY3JpcHRVcmwodGhpcy5zdW1tYXJ5KTtcblxuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IChpdGVtRGF0YVsnZGVzY3JpcHRpb24nXSAmJiBpdGVtRGF0YVsnZGVzY3JpcHRpb24nXVswXSkgPyBpdGVtRGF0YVsnZGVzY3JpcHRpb24nXVswXSA6IFwiXCI7XG5cbiAgICAgICAgICAgIHRoaXMubGluayA9ICAoaXRlbURhdGFbJ2xpbmsnXSAmJiAgaXRlbURhdGFbJ2xpbmsnXVswXSkgPyBpdGVtRGF0YVsnbGluayddWzBdIDogXCJcIjtcbiAgICAgICAgICAgIHRoaXMucHViRGF0ZSA9IGl0ZW1EYXRhWydwdWJEYXRlJ10gPyB0aGlzLl9jb252ZXJ0RGF0ZShpdGVtRGF0YVsncHViRGF0ZSddWzBdKSA6IFwiXCI7XG5cbiAgICAgICAgICAgIC8vd2UgZmlyc3QgY2hlY2sgdGl0bGUsIGlmIHRpdGxlIGNvbnRhaW5zIGRpZ2l0cyBmb3IgZmlyc3QgOCBjaGFyYWN0ZXJzLCB3ZSB1c2UgdGhhdCBhcyBVVUlEXG4gICAgICAgICAgICBpZigvXFxkKy8udGVzdCh0aGlzLnRpdGxlLnN1YnN0cigwLCA4KSkpe1xuICAgICAgICAgICAgICAgIHRoaXMudXVpZCA9IHBhcnNlSW50ICggdGhpcy50aXRsZS5zdWJzdHIoMCwgOCkpO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgdGhpcy51dWlkID0gIGl0ZW1EYXRhWydwdWJEYXRlJ10gPyB0aGlzLl9nZW5lcmF0ZVVVSUQoaXRlbURhdGFbJ3B1YkRhdGUnXVswXSkgOiAwO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmR1cmF0aW9uID0gKGl0ZW1EYXRhWydpdHVuZXM6ZHVyYXRpb24nXSAmJiBpdGVtRGF0YVsnaXR1bmVzOmR1cmF0aW9uJ11bMF0pID8gaXRlbURhdGFbJ2l0dW5lczpkdXJhdGlvbiddWzBdIDogXCJcIjtcbiAgICAgICAgICAgIHRoaXMuZW5jbG9zdXJlX2xpbmsgPSAoaXRlbURhdGFbJ2VuY2xvc3VyZSddICYmIGl0ZW1EYXRhWydlbmNsb3N1cmUnXVswXSAmJiBpdGVtRGF0YVsnZW5jbG9zdXJlJ11bMF1bJyQnXSAmJiBpdGVtRGF0YVsnZW5jbG9zdXJlJ11bMF1bJyQnXVsndXJsJ10pPyBpdGVtRGF0YVsnZW5jbG9zdXJlJ11bMF1bJyQnXVsndXJsJ10gOiBcIlwiO1xuICAgICAgICAgICAgdGhpcy5lbmNsb3N1cmVfbGVuZ3RoID0gKGl0ZW1EYXRhWydlbmNsb3N1cmUnXSAmJiBpdGVtRGF0YVsnZW5jbG9zdXJlJ11bMF0gJiYgIGl0ZW1EYXRhWydlbmNsb3N1cmUnXVswXVsnJCddICYmIGl0ZW1EYXRhWydlbmNsb3N1cmUnXVswXVsnJCddWydsZW5ndGgnXSk/IGl0ZW1EYXRhWydlbmNsb3N1cmUnXVswXVsnJCddWydsZW5ndGgnXSA6IFwiXCI7XG4gICAgICAgICAgICB0aGlzLmVuY2xvc3VyZV90eXBlID0gKGl0ZW1EYXRhWydlbmNsb3N1cmUnXSAmJiAgaXRlbURhdGFbJ2VuY2xvc3VyZSddWzBdICYmICBpdGVtRGF0YVsnZW5jbG9zdXJlJ11bMF1bJyQnXSAmJiBpdGVtRGF0YVsnZW5jbG9zdXJlJ11bMF1bJyQnXVsndHlwZSddKT8gaXRlbURhdGFbJ2VuY2xvc3VyZSddWzBdWyckJ11bJ3R5cGUnXSA6IFwiXCI7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5zdWJUaXRsZSA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLnN1bW1hcnkgPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLmxpbmsgPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5wdWJEYXRlID0gXCJcIjtcbiAgICAgICAgICAgIHRoaXMuZHVyYXRpb24gPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5lbmNsb3N1cmVfbGluayA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLmVuY2xvc3VyZV9sZW5ndGggPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5lbmNsb3N1cmVfdHlwZSA9IFwiXCI7XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgaXNUb2RheVB1Ymxpc2hlZCgpIHtcbiAgICAgICAgdmFyIHRvZGF5ID0gbmV3IERhdGUoKTtcbiAgICAgICAgdmFyIGRkID0gdG9kYXkuZ2V0RGF0ZSgpO1xuICAgICAgICB2YXIgbW0gPSB0b2RheS5nZXRNb250aCgpICsgMTsgLy9KYW51YXJ5IGlzIDAhXG4gICAgICAgIHZhciBkZHMgPSAnJztcbiAgICAgICAgdmFyIG1tcyA9ICcnO1xuICAgICAgICB2YXIgeXl5eSA9IHRvZGF5LmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIGlmIChkZCA8IDEwKSB7XG4gICAgICAgICAgICBkZHMgPSAnMCcgKyBkZFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGRzID0gJycgKyBkZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAobW0gPCAxMCkge1xuICAgICAgICAgICAgbW1zID0gJzAnICsgbW1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1tcyA9ICcnICsgbW07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRvZGF5U3RyID0geXl5eSArIFwiLVwiICsgbW1zICsgXCItXCIgKyBkZHM7XG4gICAgICAgIHZhciBkYXRlVG9Db21wYXJlID0gdGhpcy5wdWJEYXRlO1xuICAgICAgICBpZigvXFxkKy8udGVzdCh0aGlzLnRpdGxlLnN1YnN0cigwLDgpKSl7XG4gICAgICAgICAgICB2YXIgdG1wID0gdGhpcy50aXRsZS5zdWJzdHIoMCw4KTtcbiAgICAgICAgICAgIGRhdGVUb0NvbXBhcmUgPSB0bXAuc3Vic3RyKDAsNCkrJy0nK3RtcC5zdWJzdHIoNCwyKSsnLScrdG1wLnN1YnN0cig2LDIpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRhdGVUb0NvbXBhcmUgPT09IHRvZGF5U3RyO1xuICAgIH1cblxuICAgIF9leHRyYWN0U2NyaXB0VXJsKGNvbnRlbnQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHZhciBzdGFydGluZ1BvcyA9IGNvbnRlbnQuaW5kZXhPZignPGEgaHJlZj0nKSA7XG4gICAgICAgIGlmIChzdGFydGluZ1BvcyA+IDApIHtcbiAgICAgICAgICAgIHZhciBlbmRpbmdQb3MgPSBjb250ZW50LmluZGV4T2YoJ1wiJywgc3RhcnRpbmdQb3MrMjApO1xuICAgICAgICAgICAgaWYoZW5kaW5nUG9zID4gc3RhcnRpbmdQb3MrOSlcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udGVudC5zdWJzdHJpbmcoc3RhcnRpbmdQb3MrOSwgZW5kaW5nUG9zKS5yZXBsYWNlKCdhbXA7JywnJyk7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2NvbnZlcnREYXRlKGR0OiBzdHJpbmcpIHtcbiAgICAgICAgLy9TYXQsIDI2IEF1ZyAyMDE3IDAwOjAwOjAwIC0wNzAwXG4gICAgICAgIHZhciBwYXJ0cyA9IGR0LnNwbGl0KCcgJyk7XG4gICAgICAgIHZhciB5ZWFyID0gcGFydHNbM107XG4gICAgICAgIHZhciBkYXkgPSBwYXJ0c1sxXTtcbiAgICAgICAgdmFyIG1vbnRoID0gJzAxJztcbiAgICAgICAgc3dpdGNoIChwYXJ0c1syXS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICAgICAgICBjYXNlIFwiamFuXCI6IG1vbnRoID0gJzAxJzsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZmViXCI6IG1vbnRoID0gJzAyJzsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibWFyXCI6IG1vbnRoID0gJzAzJzsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiYXByXCI6IG1vbnRoID0gJzA0JzsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibWF5XCI6IG1vbnRoID0gJzA1JzsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwianVuXCI6IG1vbnRoID0gJzA2JzsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwianVsXCI6IG1vbnRoID0gJzA3JzsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiYXVnXCI6IG1vbnRoID0gJzA4JzsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwic2VwXCI6IG1vbnRoID0gJzA5JzsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwib2N0XCI6IG1vbnRoID0gJzEwJzsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibm92XCI6IG1vbnRoID0gJzExJzsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiZGVjXCI6IG1vbnRoID0gJzEyJzsgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHllYXIgKyAnLScgKyBtb250aCArICctJyArIGRheTtcbiAgICB9XG5cbiAgICBfZ2VuZXJhdGVVVUlEKGR0OnN0cmluZyk6bnVtYmVye1xuICAgICAgICAvL1NhdCwgMjYgQXVnIDIwMTcgMDA6MDA6MDAgLTA3MDBcbiAgICAgICAgdmFyIHBhcnRzID0gZHQuc3BsaXQoJyAnKTtcbiAgICAgICAgdmFyIHllYXIgPSBwYXJ0c1szXTtcbiAgICAgICAgdmFyIGRheSA9IHBhcnRzWzFdO1xuICAgICAgICB2YXIgbW9udGggPSAnMDEnO1xuICAgICAgICBzd2l0Y2ggKHBhcnRzWzJdLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgIGNhc2UgXCJqYW5cIjogbW9udGggPSAnMDEnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJmZWJcIjogbW9udGggPSAnMDInOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJtYXJcIjogbW9udGggPSAnMDMnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJhcHJcIjogbW9udGggPSAnMDQnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJtYXlcIjogbW9udGggPSAnMDUnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJqdW5cIjogbW9udGggPSAnMDYnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJqdWxcIjogbW9udGggPSAnMDcnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJhdWdcIjogbW9udGggPSAnMDgnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJzZXBcIjogbW9udGggPSAnMDknOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJvY3RcIjogbW9udGggPSAnMTAnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJub3ZcIjogbW9udGggPSAnMTEnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJkZWNcIjogbW9udGggPSAnMTInOyBicmVhaztcbiAgICAgICAgfVxuICAgICAgICB2YXIgc3RyID0geWVhciArIG1vbnRoICsgZGF5O1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQoc3RyKTtcbiAgICB9XG59XG4iXX0=