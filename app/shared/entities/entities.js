"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Rss = (function () {
    function Rss(data, rssType, lan) {
        if (data === void 0) { data = null; }
        if (rssType === void 0) { rssType = ""; }
        if (lan === void 0) { lan = ""; }
        var _this = this;
        this.channel = [];
        if (data) {
            data.rss.channel.forEach(function (channelData) {
                _this.channel.push(new Channel(channelData, rssType, lan));
            });
        }
    }
    return Rss;
}());
exports.Rss = Rss;
var Channel = (function () {
    function Channel(channelData, rssType, lan) {
        if (channelData === void 0) { channelData = null; }
        if (rssType === void 0) { rssType = ""; }
        if (lan === void 0) { lan = ""; }
        var _this = this;
        if (channelData) {
            this.title = this._processTitle(channelData['title'][0], rssType, lan);
            this.description = this._processDescription(channelData['description'][0], rssType, lan);
            this.link = channelData['link'][0];
            this.image = new ChannelImage(channelData['image'][0]);
            this.summary = channelData['itunes:summary'][0];
            this.item = [];
            var index_1 = 0;
            channelData.item.forEach(function (itemData) {
                _this.item.push(new Item(itemData, index_1));
                index_1++;
            });
        }
        else {
            this.title = "";
            this.description = "";
            this.link = "";
            this.image = new ChannelImage(null);
            this.summary = "";
            this.item = [];
        }
    }
    Channel.prototype._processTitle = function (title, rssType, lan) {
        if (rssType == 'qt') {
            if (lan == 'en') {
                return 'Quiet Time';
            }
            else {
                return '每日灵修';
            }
        }
        if (rssType == "weekly_zh") {
            if (lan == 'en') {
                return 'HOC5 Chinese Sermons';
            }
            else {
                return '基督之家第五家中文讲道';
            }
        }
        if (rssType == "weekly_en") {
            if (lan == 'en') {
                return 'HOC5 English Sermons';
            }
            else {
                return '基督之家第五家英文讲道';
            }
        }
        return title;
    };
    Channel.prototype._processDescription = function (description, rssType, lan) {
        if (rssType == "weekly_zh" || rssType == "weekly_en") {
            console.log('pased lan is ', lan);
            if (lan != 'zh') {
                return 'We are called to magnify God and glorify Him, to lead people to Jesus and membership in his family, to play a role in nurturing them to Christ like maturity, and equip them for their ministry in the church and mission in the world.';
            }
            else {
                return '北加州基督之家是由台北基督之家創辦人寇世遠監督所創立，目前基督之家在灣區已經有七家教會。第五家位於矽谷Cupertino市。有關基督之家其他各家的詳細介紹，請到 www.hoc.org';
            }
        }
        else if (rssType = 'qt') {
            return lan == 'en' ? 'For every reborn Christian, there should be one new thing added to his life, Quiet Time with God. This is not only a pure quiet time, but also a holy period with God. ' : '每一個重生得救的基督徒，在他每天的生活裏就多了一樣新事，就是「靈修生活」，它不只是個安靜的時刻 (Quiet time)，也是個敬虔的時間，更是個與神獨處的時光。';
        }
        return description;
    };
    return Channel;
}());
exports.Channel = Channel;
var ChannelImage = (function () {
    function ChannelImage(channelImageData) {
        if (channelImageData === void 0) { channelImageData = null; }
        if (channelImageData) {
            this.url = channelImageData['url'][0];
            this.title = channelImageData['title'][0];
            this.link = channelImageData['link'][0];
        }
        else {
            this.url = "";
            this.title = "";
            this.link = "";
        }
    }
    return ChannelImage;
}());
exports.ChannelImage = ChannelImage;
var CustomItem = (function () {
    function CustomItem() {
    }
    return CustomItem;
}());
exports.CustomItem = CustomItem;
var Item = (function () {
    function Item(itemData, id) {
        if (itemData === void 0) { itemData = null; }
        if (id === void 0) { id = 0; }
        this.id = id;
        if (itemData) {
            this.title = (itemData['title'] && itemData['title'][0]) ? itemData['title'][0] : "";
            this.subTitle = (itemData['itunes:subtitle'] && itemData['itunes:subtitle'][0]) ? itemData['itunes:subtitle'][0].replace('【詳見全文】', '') : "";
            this.summary = (itemData['itunes:summary'] && itemData['itunes:summary'][0]) ? itemData['itunes:summary'][0] : "";
            this.scriptUrl = this._extractScriptUrl(this.summary);
            this.description = (itemData['description'] && itemData['description'][0]) ? itemData['description'][0] : "";
            this.link = (itemData['link'] && itemData['link'][0]) ? itemData['link'][0] : "";
            this.pubDate = itemData['pubDate'] ? this._convertDate(itemData['pubDate'][0]) : "";
            this.uuid = itemData['pubDate'] ? this._generateUUID(itemData['pubDate'][0]) : 0;
            this.duration = (itemData['itunes:duration'] && itemData['itunes:duration'][0]) ? itemData['itunes:duration'][0] : "";
            this.enclosure_link = (itemData['enclosure'] && itemData['enclosure'][0] && itemData['enclosure'][0]['$'] && itemData['enclosure'][0]['$']['url']) ? itemData['enclosure'][0]['$']['url'] : "";
            this.enclosure_length = (itemData['enclosure'] && itemData['enclosure'][0] && itemData['enclosure'][0]['$'] && itemData['enclosure'][0]['$']['length']) ? itemData['enclosure'][0]['$']['length'] : "";
            this.enclosure_type = (itemData['enclosure'] && itemData['enclosure'][0] && itemData['enclosure'][0]['$'] && itemData['enclosure'][0]['$']['type']) ? itemData['enclosure'][0]['$']['type'] : "";
        }
        else {
            this.title = "";
            this.subTitle = "";
            this.summary = "";
            this.description = "";
            this.link = "";
            this.pubDate = "";
            this.duration = "";
            this.enclosure_link = "";
            this.enclosure_length = "";
            this.enclosure_type = "";
        }
    }
    Item.prototype.isTodayPublished = function () {
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!
        var dds = '';
        var mms = '';
        var yyyy = today.getFullYear();
        if (dd < 10) {
            dds = '0' + dd;
        }
        else {
            dds = '' + dd;
        }
        if (mm < 10) {
            mms = '0' + mm;
        }
        else {
            mms = '' + mm;
        }
        var todayStr = yyyy + "-" + mms + "-" + dds;
        return this.pubDate === todayStr;
    };
    Item.prototype._extractScriptUrl = function (content) {
        var startingPos = content.indexOf('<a href=');
        if (startingPos > 0) {
            var endingPos = content.indexOf('"', startingPos + 20);
            if (endingPos > startingPos + 9)
                return content.substring(startingPos + 9, endingPos).replace('amp;', '');
            else
                return '';
        }
        else {
            return '';
        }
    };
    Item.prototype._convertDate = function (dt) {
        //Sat, 26 Aug 2017 00:00:00 -0700
        var parts = dt.split(' ');
        var year = parts[3];
        var day = parts[1];
        var month = '01';
        switch (parts[2].toLowerCase()) {
            case "jan":
                month = '01';
                break;
            case "feb":
                month = '02';
                break;
            case "mar":
                month = '03';
                break;
            case "apr":
                month = '04';
                break;
            case "may":
                month = '05';
                break;
            case "jun":
                month = '06';
                break;
            case "jul":
                month = '07';
                break;
            case "aug":
                month = '08';
                break;
            case "sep":
                month = '09';
                break;
            case "oct":
                month = '10';
                break;
            case "nov":
                month = '11';
                break;
            case "dec":
                month = '12';
                break;
        }
        return year + '-' + month + '-' + day;
    };
    Item.prototype._generateUUID = function (dt) {
        //Sat, 26 Aug 2017 00:00:00 -0700
        var parts = dt.split(' ');
        var year = parts[3];
        var day = parts[1];
        var month = '01';
        switch (parts[2].toLowerCase()) {
            case "jan":
                month = '01';
                break;
            case "feb":
                month = '02';
                break;
            case "mar":
                month = '03';
                break;
            case "apr":
                month = '04';
                break;
            case "may":
                month = '05';
                break;
            case "jun":
                month = '06';
                break;
            case "jul":
                month = '07';
                break;
            case "aug":
                month = '08';
                break;
            case "sep":
                month = '09';
                break;
            case "oct":
                month = '10';
                break;
            case "nov":
                month = '11';
                break;
            case "dec":
                month = '12';
                break;
        }
        var str = year + month + day;
        return parseInt(str);
    };
    return Item;
}());
exports.Item = Item;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXRpZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJlbnRpdGllcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBO0lBRUksYUFBWSxJQUFXLEVBQUUsT0FBb0IsRUFBRSxHQUFhO1FBQWhELHFCQUFBLEVBQUEsV0FBVztRQUFFLHdCQUFBLEVBQUEsWUFBb0I7UUFBRSxvQkFBQSxFQUFBLFFBQWE7UUFBNUQsaUJBT0M7UUFORyxJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNsQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ1AsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUEsV0FBVztnQkFDaEMsS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxPQUFPLENBQUMsV0FBVyxFQUFFLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzlELENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQztJQUNMLENBQUM7SUFDTCxVQUFDO0FBQUQsQ0FBQyxBQVZELElBVUM7QUFWWSxrQkFBRztBQVloQjtJQVFJLGlCQUFZLFdBQWtCLEVBQUUsT0FBb0IsRUFBRSxHQUFhO1FBQXZELDRCQUFBLEVBQUEsa0JBQWtCO1FBQUUsd0JBQUEsRUFBQSxZQUFvQjtRQUFFLG9CQUFBLEVBQUEsUUFBYTtRQUFuRSxpQkEwQkM7UUF4QkcsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNkLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZFLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDekYsSUFBSSxDQUFDLElBQUksR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLFlBQVksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2RCxJQUFJLENBQUMsT0FBTyxHQUFHLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRWhELElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBRWYsSUFBSSxPQUFLLEdBQUcsQ0FBQyxDQUFDO1lBRWQsV0FBVyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBQSxRQUFRO2dCQUM3QixLQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsT0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDMUMsT0FBSyxFQUFFLENBQUM7WUFDWixDQUFDLENBQUMsQ0FBQztRQUNQLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNKLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1lBQ2hCLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDO1lBQ3RCLElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBQ2YsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwQyxJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztZQUVsQixJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNuQixDQUFDO0lBQ0wsQ0FBQztJQUVELCtCQUFhLEdBQWIsVUFBYyxLQUFLLEVBQUUsT0FBTyxFQUFFLEdBQUc7UUFFN0IsRUFBRSxDQUFBLENBQUMsT0FBTyxJQUFFLElBQUksQ0FBQyxDQUFBLENBQUM7WUFDZCxFQUFFLENBQUEsQ0FBQyxHQUFHLElBQUUsSUFBSSxDQUFDLENBQUEsQ0FBQztnQkFDVixNQUFNLENBQUMsWUFBWSxDQUFDO1lBQ3hCLENBQUM7WUFBQSxJQUFJLENBQUEsQ0FBQztnQkFDRixNQUFNLENBQUMsTUFBTSxDQUFDO1lBQ2xCLENBQUM7UUFDTCxDQUFDO1FBQ0QsRUFBRSxDQUFBLENBQUMsT0FBTyxJQUFJLFdBQVcsQ0FBQyxDQUFBLENBQUM7WUFDdkIsRUFBRSxDQUFBLENBQUMsR0FBRyxJQUFFLElBQUksQ0FBQyxDQUFBLENBQUM7Z0JBQ1YsTUFBTSxDQUFDLHNCQUFzQixDQUFDO1lBQ2xDLENBQUM7WUFBQSxJQUFJLENBQUEsQ0FBQztnQkFDRixNQUFNLENBQUMsYUFBYSxDQUFDO1lBQ3pCLENBQUM7UUFDTCxDQUFDO1FBRUQsRUFBRSxDQUFBLENBQUMsT0FBTyxJQUFJLFdBQVcsQ0FBQyxDQUFBLENBQUM7WUFDdkIsRUFBRSxDQUFBLENBQUMsR0FBRyxJQUFFLElBQUksQ0FBQyxDQUFBLENBQUM7Z0JBQ1YsTUFBTSxDQUFDLHNCQUFzQixDQUFDO1lBQ2xDLENBQUM7WUFBQSxJQUFJLENBQUEsQ0FBQztnQkFDRixNQUFNLENBQUMsYUFBYSxDQUFDO1lBQ3pCLENBQUM7UUFDTCxDQUFDO1FBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUVqQixDQUFDO0lBRUQscUNBQW1CLEdBQW5CLFVBQW9CLFdBQVcsRUFBRSxPQUFPLEVBQUUsR0FBRztRQUN6QyxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksV0FBVyxJQUFJLE9BQU8sSUFBSSxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ25ELE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ2xDLEVBQUUsQ0FBQSxDQUFDLEdBQUcsSUFBRSxJQUFJLENBQUMsQ0FBQSxDQUFDO2dCQUNWLE1BQU0sQ0FBQyx5T0FBeU8sQ0FBQztZQUNyUCxDQUFDO1lBQUEsSUFBSSxDQUFBLENBQUM7Z0JBQ0YsTUFBTSxDQUFDLDhGQUE4RixDQUFDO1lBQzFHLENBQUM7UUFDTCxDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLE9BQU8sR0FBQyxJQUFJLENBQUMsQ0FBQSxDQUFDO1lBQ3BCLE1BQU0sQ0FBQyxHQUFHLElBQUUsSUFBSSxHQUFDLHlLQUF5SyxHQUFFLG1GQUFtRixDQUFDO1FBQ3BSLENBQUM7UUFDRCxNQUFNLENBQUMsV0FBVyxDQUFDO0lBQ3ZCLENBQUM7SUFFTCxjQUFDO0FBQUQsQ0FBQyxBQS9FRCxJQStFQztBQS9FWSwwQkFBTztBQW1GcEI7SUFLSSxzQkFBWSxnQkFBdUI7UUFBdkIsaUNBQUEsRUFBQSx1QkFBdUI7UUFFL0IsRUFBRSxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1lBQ25CLElBQUksQ0FBQyxHQUFHLEdBQUcsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEMsSUFBSSxDQUFDLEtBQUssR0FBRyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxQyxJQUFJLENBQUMsSUFBSSxHQUFHLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzVDLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUVKLElBQUksQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO1lBQ2QsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7UUFDbkIsQ0FBQztJQUNMLENBQUM7SUFDTCxtQkFBQztBQUFELENBQUMsQUFsQkQsSUFrQkM7QUFsQlksb0NBQVk7QUFvQnpCO0lBQUE7SUFNQSxDQUFDO0lBQUQsaUJBQUM7QUFBRCxDQUFDLEFBTkQsSUFNQztBQU5ZLGdDQUFVO0FBUXZCO0lBb0JJLGNBQVksUUFBZSxFQUFFLEVBQU07UUFBdkIseUJBQUEsRUFBQSxlQUFlO1FBQUUsbUJBQUEsRUFBQSxNQUFNO1FBQy9CLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBQ2IsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUNYLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUNyRixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLElBQUksUUFBUSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUU1SSxJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLElBQUksUUFBUSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDbEgsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRXRELElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksUUFBUSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUU3RyxJQUFJLENBQUMsSUFBSSxHQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFLLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDbkYsSUFBSSxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDcEYsSUFBSSxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFakYsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBRXRILElBQUksQ0FBQyxjQUFjLEdBQUcsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRSxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQzlMLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUssUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMs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LElBQUksQ0FBQztnQkFBQyxLQUFLLENBQUM7WUFDaEMsS0FBSyxLQUFLO2dCQUFFLEtBQUssR0FBRyxJQUFJLENBQUM7Z0JBQUMsS0FBSyxDQUFDO1lBQ2hDLEtBQUssS0FBSztnQkFBRSxLQUFLLEdBQUcsSUFBSSxDQUFDO2dCQUFDLEtBQUssQ0FBQztZQUNoQyxLQUFLLEtBQUs7Z0JBQUUsS0FBSyxHQUFHLElBQUksQ0FBQztnQkFBQyxLQUFLLENBQUM7WUFDaEMsS0FBSyxLQUFLO2dCQUFFLEtBQUssR0FBRyxJQUFJLENBQUM7Z0JBQUMsS0FBSyxDQUFDO1lBQ2hDLEtBQUssS0FBSztnQkFBRSxLQUFLLEdBQUcsSUFBSSxDQUFDO2dCQUFDLEtBQUssQ0FBQztZQUNoQyxLQUFLLEtBQUs7Z0JBQUUsS0FBSyxHQUFHLElBQUksQ0FBQztnQkFBQyxLQUFLLENBQUM7WUFDaEMsS0FBSyxLQUFLO2dCQUFFLEtBQUssR0FBRyxJQUFJLENBQUM7Z0JBQUMsS0FBSyxDQUFDO1lBQ2hDLEtBQUssS0FBSztnQkFBRSxLQUFLLEdBQUcsSUFBSSxDQUFDO2dCQUFDLEtBQUssQ0FBQztRQUNwQyxDQUFDO1FBQ0QsSUFBSSxHQUFHLEdBQUcsSUFBSSxHQUFHLEtBQUssR0FBRyxHQUFHLENBQUM7UUFDN0IsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN6QixDQUFDO0lBQ0wsV0FBQztBQUFELENBQUMsQUF6SUQsSUF5SUM7QUF6SVksb0JBQUkiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgUnNzIHtcbiAgICBwdWJsaWMgY2hhbm5lbDogQ2hhbm5lbFtdO1xuICAgIGNvbnN0cnVjdG9yKGRhdGEgPSBudWxsLCByc3NUeXBlOiBzdHJpbmcgPSBcIlwiLCBsYW46c3RyaW5nPVwiXCIpIHtcbiAgICAgICAgdGhpcy5jaGFubmVsID0gW107XG4gICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICBkYXRhLnJzcy5jaGFubmVsLmZvckVhY2goY2hhbm5lbERhdGEgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhbm5lbC5wdXNoKG5ldyBDaGFubmVsKGNoYW5uZWxEYXRhLCByc3NUeXBlLCBsYW4pKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ2hhbm5lbCB7XG4gICAgcHVibGljIHRpdGxlOiBzdHJpbmc7XG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgcHVibGljIGltYWdlOiBDaGFubmVsSW1hZ2U7XG4gICAgcHVibGljIHN1bW1hcnk6IHN0cmluZztcbiAgICBwdWJsaWMgaXRlbTogSXRlbVtdO1xuICAgIHB1YmxpYyBsaW5rOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3RvcihjaGFubmVsRGF0YSA9IG51bGwsIHJzc1R5cGU6IHN0cmluZyA9IFwiXCIsIGxhbjpzdHJpbmc9XCJcIikge1xuXG4gICAgICAgIGlmIChjaGFubmVsRGF0YSkge1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IHRoaXMuX3Byb2Nlc3NUaXRsZShjaGFubmVsRGF0YVsndGl0bGUnXVswXSwgcnNzVHlwZSwgbGFuKTtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSB0aGlzLl9wcm9jZXNzRGVzY3JpcHRpb24oY2hhbm5lbERhdGFbJ2Rlc2NyaXB0aW9uJ11bMF0sIHJzc1R5cGUsIGxhbik7XG4gICAgICAgICAgICB0aGlzLmxpbmsgPSBjaGFubmVsRGF0YVsnbGluayddWzBdO1xuICAgICAgICAgICAgdGhpcy5pbWFnZSA9IG5ldyBDaGFubmVsSW1hZ2UoY2hhbm5lbERhdGFbJ2ltYWdlJ11bMF0pO1xuICAgICAgICAgICAgdGhpcy5zdW1tYXJ5ID0gY2hhbm5lbERhdGFbJ2l0dW5lczpzdW1tYXJ5J11bMF07XG5cbiAgICAgICAgICAgIHRoaXMuaXRlbSA9IFtdO1xuXG4gICAgICAgICAgICBsZXQgaW5kZXggPSAwO1xuXG4gICAgICAgICAgICBjaGFubmVsRGF0YS5pdGVtLmZvckVhY2goaXRlbURhdGEgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbS5wdXNoKG5ldyBJdGVtKGl0ZW1EYXRhLCBpbmRleCkpO1xuICAgICAgICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLmxpbmsgPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5pbWFnZSA9IG5ldyBDaGFubmVsSW1hZ2UobnVsbCk7XG4gICAgICAgICAgICB0aGlzLnN1bW1hcnkgPSBcIlwiO1xuXG4gICAgICAgICAgICB0aGlzLml0ZW0gPSBbXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9wcm9jZXNzVGl0bGUodGl0bGUsIHJzc1R5cGUsIGxhbil7XG5cbiAgICAgICAgaWYocnNzVHlwZT09J3F0Jyl7XG4gICAgICAgICAgICBpZihsYW49PSdlbicpe1xuICAgICAgICAgICAgICAgIHJldHVybiAnUXVpZXQgVGltZSc7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ+avj+aXpeeBteS/ric7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYocnNzVHlwZSA9PSBcIndlZWtseV96aFwiKXtcbiAgICAgICAgICAgIGlmKGxhbj09J2VuJyl7XG4gICAgICAgICAgICAgICAgcmV0dXJuICdIT0M1IENoaW5lc2UgU2VybW9ucyc7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ+Wfuuedo+S5i+WutuesrOS6lOWutuS4reaWh+iusumBkyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZihyc3NUeXBlID09IFwid2Vla2x5X2VuXCIpe1xuICAgICAgICAgICAgaWYobGFuPT0nZW4nKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ0hPQzUgRW5nbGlzaCBTZXJtb25zJztcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHJldHVybiAn5Z+6552j5LmL5a6256ys5LqU5a626Iux5paH6K6y6YGTJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aXRsZTtcblxuICAgIH1cblxuICAgIF9wcm9jZXNzRGVzY3JpcHRpb24oZGVzY3JpcHRpb24sIHJzc1R5cGUsIGxhbikge1xuICAgICAgICBpZiAocnNzVHlwZSA9PSBcIndlZWtseV96aFwiIHx8IHJzc1R5cGUgPT0gXCJ3ZWVrbHlfZW5cIikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Bhc2VkIGxhbiBpcyAnLCBsYW4pO1xuICAgICAgICAgICAgaWYobGFuIT0nemgnKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ1dlIGFyZSBjYWxsZWQgdG8gbWFnbmlmeSBHb2QgYW5kIGdsb3JpZnkgSGltLCB0byBsZWFkIHBlb3BsZSB0byBKZXN1cyBhbmQgbWVtYmVyc2hpcCBpbiBoaXMgZmFtaWx5LCB0byBwbGF5IGEgcm9sZSBpbiBudXJ0dXJpbmcgdGhlbSB0byBDaHJpc3QgbGlrZSBtYXR1cml0eSwgYW5kIGVxdWlwIHRoZW0gZm9yIHRoZWlyIG1pbmlzdHJ5IGluIHRoZSBjaHVyY2ggYW5kIG1pc3Npb24gaW4gdGhlIHdvcmxkLic7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ+WMl+WKoOW3nuWfuuedo+S5i+WutuaYr+eUseWPsOWMl+Wfuuedo+S5i+WutuWJtei+puS6uuWvh+S4lumBoOebo+edo+aJgOWJteeri++8jOebruWJjeWfuuedo+S5i+WutuWcqOeBo+WNgOW3sue2k+acieS4g+WutuaVmeacg+OAguesrOS6lOWutuS9jeaWvOefveiwt0N1cGVydGlub+W4guOAguaciemXnOWfuuedo+S5i+WutuWFtuS7luWQhOWutueahOips+e0sOS7i+e0ue+8jOiri+WIsCB3d3cuaG9jLm9yZyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZihyc3NUeXBlPSdxdCcpe1xuICAgICAgICAgICAgcmV0dXJuIGxhbj09J2VuJz8nRm9yIGV2ZXJ5IHJlYm9ybiBDaHJpc3RpYW4sIHRoZXJlIHNob3VsZCBiZSBvbmUgbmV3IHRoaW5nIGFkZGVkIHRvIGhpcyBsaWZlLCBRdWlldCBUaW1lIHdpdGggR29kLiBUaGlzIGlzIG5vdCBvbmx5IGEgcHVyZSBxdWlldCB0aW1lLCBidXQgYWxzbyBhIGhvbHkgcGVyaW9kIHdpdGggR29kLiAnOiAn5q+P5LiA5YCL6YeN55Sf5b6X5pWR55qE5Z+6552j5b6S77yM5Zyo5LuW5q+P5aSp55qE55Sf5rS76KOP5bCx5aSa5LqG5LiA5qij5paw5LqL77yM5bCx5piv44CM6Z2I5L+u55Sf5rS744CN77yM5a6D5LiN5Y+q5piv5YCL5a6J6Z2c55qE5pmC5Yi7IChRdWlldCB0aW1lKe+8jOS5n+aYr+WAi+aVrOiZlOeahOaZgumWk++8jOabtOaYr+WAi+iIh+elnueNqOiZleeahOaZguWFieOAgic7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlc2NyaXB0aW9uO1xuICAgIH1cblxufVxuXG5cblxuZXhwb3J0IGNsYXNzIENoYW5uZWxJbWFnZSB7XG4gICAgcHVibGljIHVybDogc3RyaW5nO1xuICAgIHB1YmxpYyB0aXRsZTogc3RyaW5nO1xuICAgIHB1YmxpYyBsaW5rOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3RvcihjaGFubmVsSW1hZ2VEYXRhID0gbnVsbCkge1xuXG4gICAgICAgIGlmIChjaGFubmVsSW1hZ2VEYXRhKSB7XG4gICAgICAgICAgICB0aGlzLnVybCA9IGNoYW5uZWxJbWFnZURhdGFbJ3VybCddWzBdO1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IGNoYW5uZWxJbWFnZURhdGFbJ3RpdGxlJ11bMF07XG4gICAgICAgICAgICB0aGlzLmxpbmsgPSBjaGFubmVsSW1hZ2VEYXRhWydsaW5rJ11bMF07XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIHRoaXMudXJsID0gXCJcIjtcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5saW5rID0gXCJcIjtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEN1c3RvbUl0ZW17XG4gICAgcHVibGljIGlkOm51bWJlcjtcbiAgICBwdWJsaWMgdGl0bGU6c3RyaW5nO1xuICAgIHB1YmxpYyBub3RlOnN0cmluZztcbiAgICBwdWJsaWMgZmF2b3JpdGU6Ym9vbGVhbjtcbiAgICBwdWJsaWMgdXVpZDpudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBJdGVtIHtcblxuICAgIHB1YmxpYyBpZDpudW1iZXI7XG4gICAgcHVibGljIHRpdGxlOiBzdHJpbmc7XG4gICAgcHVibGljIHN1YlRpdGxlOiBzdHJpbmc7XG4gICAgcHVibGljIHN1bW1hcnk6IHN0cmluZztcbiAgICBwdWJsaWMgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICBwdWJsaWMgbGluazogc3RyaW5nO1xuICAgIHB1YmxpYyBlbmNsb3N1cmVfbGluazogc3RyaW5nO1xuICAgIHB1YmxpYyBlbmNsb3N1cmVfbGVuZ3RoOiBzdHJpbmc7XG4gICAgcHVibGljIGVuY2xvc3VyZV90eXBlOiBzdHJpbmc7XG5cbiAgICBwdWJsaWMgZHVyYXRpb246IHN0cmluZztcbiAgICBwdWJsaWMgcHViRGF0ZTogc3RyaW5nO1xuXG4gICAgcHVibGljIHNjcmlwdFVybDogc3RyaW5nO1xuICAgIHB1YmxpYyBzY3JpcHR1cmU6IHN0cmluZztcblxuICAgIHB1YmxpYyB1dWlkOm51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKGl0ZW1EYXRhID0gbnVsbCwgaWQgPSAwKSB7XG4gICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgaWYgKGl0ZW1EYXRhKSB7XG4gICAgICAgICAgICB0aGlzLnRpdGxlID0gKGl0ZW1EYXRhWyd0aXRsZSddICYmIGl0ZW1EYXRhWyd0aXRsZSddWzBdKSA/IGl0ZW1EYXRhWyd0aXRsZSddWzBdIDogXCJcIjtcbiAgICAgICAgICAgIHRoaXMuc3ViVGl0bGUgPSAoaXRlbURhdGFbJ2l0dW5lczpzdWJ0aXRsZSddICYmIGl0ZW1EYXRhWydpdHVuZXM6c3VidGl0bGUnXVswXSkgPyBpdGVtRGF0YVsnaXR1bmVzOnN1YnRpdGxlJ11bMF0ucmVwbGFjZSgn44CQ6Kmz6KaL5YWo5paH44CRJywgJycpIDogXCJcIjtcblxuICAgICAgICAgICAgdGhpcy5zdW1tYXJ5ID0gKGl0ZW1EYXRhWydpdHVuZXM6c3VtbWFyeSddICYmIGl0ZW1EYXRhWydpdHVuZXM6c3VtbWFyeSddWzBdKSA/IGl0ZW1EYXRhWydpdHVuZXM6c3VtbWFyeSddWzBdIDogXCJcIjtcbiAgICAgICAgICAgIHRoaXMuc2NyaXB0VXJsID0gdGhpcy5fZXh0cmFjdFNjcmlwdFVybCh0aGlzLnN1bW1hcnkpO1xuXG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gKGl0ZW1EYXRhWydkZXNjcmlwdGlvbiddICYmIGl0ZW1EYXRhWydkZXNjcmlwdGlvbiddWzBdKSA/IGl0ZW1EYXRhWydkZXNjcmlwdGlvbiddWzBdIDogXCJcIjtcblxuICAgICAgICAgICAgdGhpcy5saW5rID0gIChpdGVtRGF0YVsnbGluayddICYmICBpdGVtRGF0YVsnbGluayddWzBdKSA/IGl0ZW1EYXRhWydsaW5rJ11bMF0gOiBcIlwiO1xuICAgICAgICAgICAgdGhpcy5wdWJEYXRlID0gaXRlbURhdGFbJ3B1YkRhdGUnXSA/IHRoaXMuX2NvbnZlcnREYXRlKGl0ZW1EYXRhWydwdWJEYXRlJ11bMF0pIDogXCJcIjtcbiAgICAgICAgICAgIHRoaXMudXVpZCA9IGl0ZW1EYXRhWydwdWJEYXRlJ10gPyB0aGlzLl9nZW5lcmF0ZVVVSUQoaXRlbURhdGFbJ3B1YkRhdGUnXVswXSkgOiAwO1xuXG4gICAgICAgICAgICB0aGlzLmR1cmF0aW9uID0gKGl0ZW1EYXRhWydpdHVuZXM6ZHVyYXRpb24nXSAmJiBpdGVtRGF0YVsnaXR1bmVzOmR1cmF0aW9uJ11bMF0pID8gaXRlbURhdGFbJ2l0dW5lczpkdXJhdGlvbiddWzBdIDogXCJcIjtcblxuICAgICAgICAgICAgdGhpcy5lbmNsb3N1cmVfbGluayA9IChpdGVtRGF0YVsnZW5jbG9zdXJlJ10gJiYgaXRlbURhdGFbJ2VuY2xvc3VyZSddWzBdICYmIGl0ZW1EYXRhWydlbmNsb3N1cmUnXVswXVsnJCddICYmIGl0ZW1EYXRhWydlbmNsb3N1cmUnXVswXVsnJCddWyd1cmwnXSk/IGl0ZW1EYXRhWydlbmNsb3N1cmUnXVswXVsnJCddWyd1cmwnXSA6IFwiXCI7XG4gICAgICAgICAgICB0aGlzLmVuY2xvc3VyZV9sZW5ndGggPSAoaXRlbURhdGFbJ2VuY2xvc3VyZSddICYmIGl0ZW1EYXRhWydlbmNsb3N1cmUnXVswXSAmJiAgaXRlbURhdGFbJ2VuY2xvc3VyZSddWzBdWyckJ10gJiYgaXRlbURhdGFbJ2VuY2xvc3VyZSddWzBdWyckJ11bJ2xlbmd0aCddKT8gaXRlbURhdGFbJ2VuY2xvc3VyZSddWzBdWyckJ11bJ2xlbmd0aCddIDogXCJcIjtcbiAgICAgICAgICAgIHRoaXMuZW5jbG9zdXJlX3R5cGUgPSAoaXRlbURhdGFbJ2VuY2xvc3VyZSddICYmICBpdGVtRGF0YVsnZW5jbG9zdXJlJ11bMF0gJiYgIGl0ZW1EYXRhWydlbmNsb3N1cmUnXVswXVsnJCddICYmIGl0ZW1EYXRhWydlbmNsb3N1cmUnXVswXVsnJCddWyd0eXBlJ10pPyBpdGVtRGF0YVsnZW5jbG9zdXJlJ11bMF1bJyQnXVsndHlwZSddIDogXCJcIjtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50aXRsZSA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLnN1YlRpdGxlID0gXCJcIjtcbiAgICAgICAgICAgIHRoaXMuc3VtbWFyeSA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gXCJcIjtcbiAgICAgICAgICAgIHRoaXMubGluayA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLnB1YkRhdGUgPSBcIlwiO1xuICAgICAgICAgICAgdGhpcy5kdXJhdGlvbiA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLmVuY2xvc3VyZV9saW5rID0gXCJcIjtcbiAgICAgICAgICAgIHRoaXMuZW5jbG9zdXJlX2xlbmd0aCA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLmVuY2xvc3VyZV90eXBlID0gXCJcIjtcblxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBpc1RvZGF5UHVibGlzaGVkKCkge1xuICAgICAgICB2YXIgdG9kYXkgPSBuZXcgRGF0ZSgpO1xuICAgICAgICB2YXIgZGQgPSB0b2RheS5nZXREYXRlKCk7XG4gICAgICAgIHZhciBtbSA9IHRvZGF5LmdldE1vbnRoKCkgKyAxOyAvL0phbnVhcnkgaXMgMCFcbiAgICAgICAgdmFyIGRkcyA9ICcnO1xuICAgICAgICB2YXIgbW1zID0gJyc7XG4gICAgICAgIHZhciB5eXl5ID0gdG9kYXkuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgaWYgKGRkIDwgMTApIHtcbiAgICAgICAgICAgIGRkcyA9ICcwJyArIGRkXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkZHMgPSAnJyArIGRkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtbSA8IDEwKSB7XG4gICAgICAgICAgICBtbXMgPSAnMCcgKyBtbVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbW1zID0gJycgKyBtbTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdG9kYXlTdHIgPSB5eXl5ICsgXCItXCIgKyBtbXMgKyBcIi1cIiArIGRkcztcbiAgICAgICAgcmV0dXJuIHRoaXMucHViRGF0ZSA9PT0gdG9kYXlTdHI7XG4gICAgfVxuXG4gICAgX2V4dHJhY3RTY3JpcHRVcmwoY29udGVudDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgdmFyIHN0YXJ0aW5nUG9zID0gY29udGVudC5pbmRleE9mKCc8YSBocmVmPScpIDtcbiAgICAgICAgaWYgKHN0YXJ0aW5nUG9zID4gMCkge1xuICAgICAgICAgICAgdmFyIGVuZGluZ1BvcyA9IGNvbnRlbnQuaW5kZXhPZignXCInLCBzdGFydGluZ1BvcysyMCk7XG4gICAgICAgICAgICBpZihlbmRpbmdQb3MgPiBzdGFydGluZ1Bvcys5KVxuICAgICAgICAgICAgICAgIHJldHVybiBjb250ZW50LnN1YnN0cmluZyhzdGFydGluZ1Bvcys5LCBlbmRpbmdQb3MpLnJlcGxhY2UoJ2FtcDsnLCcnKTtcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfY29udmVydERhdGUoZHQ6IHN0cmluZykge1xuICAgICAgICAvL1NhdCwgMjYgQXVnIDIwMTcgMDA6MDA6MDAgLTA3MDBcbiAgICAgICAgdmFyIHBhcnRzID0gZHQuc3BsaXQoJyAnKTtcbiAgICAgICAgdmFyIHllYXIgPSBwYXJ0c1szXTtcbiAgICAgICAgdmFyIGRheSA9IHBhcnRzWzFdO1xuICAgICAgICB2YXIgbW9udGggPSAnMDEnO1xuICAgICAgICBzd2l0Y2ggKHBhcnRzWzJdLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgIGNhc2UgXCJqYW5cIjogbW9udGggPSAnMDEnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJmZWJcIjogbW9udGggPSAnMDInOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJtYXJcIjogbW9udGggPSAnMDMnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJhcHJcIjogbW9udGggPSAnMDQnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJtYXlcIjogbW9udGggPSAnMDUnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJqdW5cIjogbW9udGggPSAnMDYnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJqdWxcIjogbW9udGggPSAnMDcnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJhdWdcIjogbW9udGggPSAnMDgnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJzZXBcIjogbW9udGggPSAnMDknOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJvY3RcIjogbW9udGggPSAnMTAnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJub3ZcIjogbW9udGggPSAnMTEnOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJkZWNcIjogbW9udGggPSAnMTInOyBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geWVhciArICctJyArIG1vbnRoICsgJy0nICsgZGF5O1xuICAgIH1cblxuICAgIF9nZW5lcmF0ZVVVSUQoZHQ6c3RyaW5nKTpudW1iZXJ7XG4gICAgICAgIC8vU2F0LCAyNiBBdWcgMjAxNyAwMDowMDowMCAtMDcwMFxuICAgICAgICB2YXIgcGFydHMgPSBkdC5zcGxpdCgnICcpO1xuICAgICAgICB2YXIgeWVhciA9IHBhcnRzWzNdO1xuICAgICAgICB2YXIgZGF5ID0gcGFydHNbMV07XG4gICAgICAgIHZhciBtb250aCA9ICcwMSc7XG4gICAgICAgIHN3aXRjaCAocGFydHNbMl0udG9Mb3dlckNhc2UoKSkge1xuICAgICAgICAgICAgY2FzZSBcImphblwiOiBtb250aCA9ICcwMSc7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImZlYlwiOiBtb250aCA9ICcwMic7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm1hclwiOiBtb250aCA9ICcwMyc7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImFwclwiOiBtb250aCA9ICcwNCc7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm1heVwiOiBtb250aCA9ICcwNSc7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImp1blwiOiBtb250aCA9ICcwNic7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImp1bFwiOiBtb250aCA9ICcwNyc7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImF1Z1wiOiBtb250aCA9ICcwOCc7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInNlcFwiOiBtb250aCA9ICcwOSc7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm9jdFwiOiBtb250aCA9ICcxMCc7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcIm5vdlwiOiBtb250aCA9ICcxMSc7IGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImRlY1wiOiBtb250aCA9ICcxMic7IGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHZhciBzdHIgPSB5ZWFyICsgbW9udGggKyBkYXk7XG4gICAgICAgIHJldHVybiBwYXJzZUludChzdHIpO1xuICAgIH1cbn1cbiJdfQ==